- footsteps sound used on castle hall and doom level has some awful
  noise at the end. You don't hear it when the music plays, but when
  music stops it can be clearly heard.

- doom music file is too large!

- bow must work better to really appreciate the doom level !
- fire over barrels - pixel pracht finally ?
- werewolf cannot crawl inside DOOM E1M1 corridor between room 1st and 3rd
  too large bounding sphere

- on castle_hall level, stand very close the box that has the button on it.
  Press "crouch". You start slowly getting falling down effect.

- doom: in each room, check:

  interactive doors/elevators (left: from 4 to 9, in 9)
  lava (left: rooms 4, 8)
  interactive barrels (left: rooms 4, 5, 8, 9)
  items to pick up (left: rooms 4, 5, 8, 9)
  creatures (left: room 9)

  finish things on castle-doom page.

  use data/levels/doom/logo/doom_title.png, since I did it..

  - room 6: creatures should see through texture with alpha channel
  - creatures should see through fake "barrier" texture (in some
    special cases if creatures will be able to do something)
  - implement all doom e1m1 secrets. The secret that allow the speedwalk:
    what was it? Check WWW for list of known E1M1 secrets.
  - room 4 is a little too dark, especially areas around the entrances to room 8 and 9

- test kolizji ze strzalami jest chyba za latwy: kiedy potwor stoi obok
  sciany, jest latwo strzelic w sciane zamiast potwora.
  Solution: traktuj strzale jako odcinek ?
  Ew. eksplozje na strzaly tez moga pomoc ?

- ball missile should hit other creatures too (helpful on crowdy places
  on Doom level)

- the fact that alien dying falls on it's back means that usually
  after alien falls dead (killed with a sword) it makes strange
  collision detection problems. It would be most natural to make
  2 alien death animations, depending on the direction of attack
  (I have direction of attack for knockback anyway) ?

- on Doom level: no way to turn off music ?
  alSourcef(MusicPlayer.FAllocatedSource.ALSource,
        AL_GAIN, MusicVolume * SoundInfos[MusicPlayer.PlayedSound].Gain);
  doesn't mute the music !
  In fact, it doesn't seem to affect music at all. Strange, as it works
  for other music !

----------------------------------------

- knockback for player sword (or for some other short-range weapon ?)

- Traveler's screenshot from geforce 6800gt also shows artifact when rendering life indicator --- it should be rendered with blending (like on Huehnerschaender screenshot), while on Traveler's screenshots it shows white background underneath.
  Hooray! It's reproduceable now on kangury!
  Started investigation in ../non_alpha_life_indicator_problem.patch

- The reson why FreeRootNodes = false for now:

  With FreeRootNodes we have a bug only in -dRELEASE mode:

  kangury: dying anim of Alien is not what it should be.
  Observed with ../castle --debug-no-creatures,
  enter "Gate", add Alien, kill it (by debug menu or as usual).

  Shiit! It happens always when compiled with -dRELEASE.
  It doesn't happen in debug builds!
  Seems like setting FreeRootNodes to @false cures (workarounds?) this.
  Happens with and without --debug-no-creatures

  With 0.6.5 compiled this doesn't happen !
  With and without --debug-no-creatures !

  Even when I compile 0.6.5. sources on kangury, the bug is not present.
  That's good --- it means that I triggered this bug somewhere during
  post-0.6.5 development. I'll just go and check using various units/
  versions from SVN and investigate this.

  I can just do inside source/ :
    svn checkout -r XXX file:///home/kambi/kambi-svn-repos/kambi_pascal_units/trunk units
  to checkout specific sources version.

  With current revision (1159) the bug occurs.
  With revision 1021 (when castle 0.6.5 was tagged in SVN): no bug.
  Perfect. Now we will just see where exactly is the border between 1021 an 1159.
  1100: Yes, there's a bug.
  1060: Yes, there's a bug.
  1040: Yes, there's a bug.
  1030: Yes, there's a bug.
  1025: No bug.
  1027: Yes, there's a bug.
  1026: Yes, there's a bug.

  So the bug appeared when 1026 was committed.

  svn diff -r1025:1026 file:///home/kambi/kambi-svn-repos

  Yes!
  I can now reproduce svn diff 1025:1026 changes in trunk,
  and then indeed I can make the bug appear/disappear.
  What remains is to locate which code in the diff,
  exactly, produces the problem.

  Well, it seems that the bug appears when field
    FParentFields: TVRMLFieldsList;
  is declared in TVRMLNode class, and disappears
  as soon as it's not declared. Not that the bug is there
  even when the field is declared but absolutely not touched
  elsewhere (not created/destroyed in TVRMLNode constructors/
  desctructors, not read/set anywhere!).

  Seems it's really some weird mem/fpc optimizer problem.
  More tests need to be done with other FPC versions,
  on other OSes etc. Make testcase and submit FPC bug.

  For now I will work with FreeRootNodes = @false,
  this will not harm us (we will just eat a little more memory
  --- 13 MB more, as tested on kangury; this is acceptable loss).

- Radeon problems

  Reported on PGD:
  1.Loading time (creating display lists for animations) is ridicuously long.
    Confirmed on Majka.

  2.Volumetric fog somehow gets applied to upper rock parts.
    Confirmed on Majka.
    Probably fixed by recent volumetric fix for Mesa.

  3.2d controls problems --- sword should be with alpha-test, item slots' borders should be with blending. But on Radeon screenshots they all look as if they were drawn "just like that", covering things underneath.
    No problems on Majka Windows.
    Maybe glProjectionPushPop will silently fix this ?

  4.Switching task (Alt+Tab) craps graphics when switching back to game (although this is known to happen on older Windowses (98 and like) with crappy graphic drivers, it definitely should not happen on XP with latest ATI drivers).
    No such problems on Majka Windows.

  On Majka Windows:
  5.Switching task (Alt+Tab) while "Loading creatures" craps things --- or maybe I was impatient ?

  6.FPS is awfully low.

  7.Switching task (Alt+Tab) and going back to game causes "can't change display settings" warning.

  8.Using ctrl+alt+del to bring taskmgr -> taskmgr.exe fails. Well, this is definitely Radeon's problem. But maybe I'm just overloading the system too much ?

  9.No music on "The Gate" level. Oh, and the menu music also doesn't play when going back from the game.

  10.view3dscene: with status text, FPS is much lower.

  - Check changing ColorsBits and VideoFrequency on Radeon, maybe will help for some problems ?
    Check disabling lockArrays in renderer.

- mouse sensitivity problems:

  There's also the problem with wrong mouse sensitivity, it seems that the mouse sensitivity values get assigned completely wrong. Sometimes it gets 9.0, sometimes it gets some ridiculous large value (though it's not MaxSingle). I understand now that this was also meant by Traveler in "Something else I noticed is that changed controls are not loaded properly again when restarting the game. I think you are converting values incorrectly.". This is very strange, because these values are actually changed only when reading them from config file, or setting them to default, or moving the slider in the menu. And converting is done using the plain StrToFloat / FloatToStr routines. And, needless to say, I don't experience these problems --- neither on Linux nor on Windows (XP and 2000 Prof). So they may indicate some memory corruption.

  function StrToFloatDef(const s: string; DefValue: Extended): Extended;

  Was there a bug about this in FPC ? I don't remember, but I have this
  in my KambiStringUtils.
  No, the bug that I remembered was for Hex2Dec.

  maybe it was the problem with wrong overloads choosing ?
  Compile in objfpc mode for test.

  Possibly fixed by rename GetValue -> GetFloat (that was needed anyway
  for code cleanliness)

  Maybe add a sanity check for mouseSensit values to MatrixWalker
  --- if outside range, use default ? Just in case it's some real bug
  in FPC etc.

  I should close this issue after doing more tests on other computers
  (Windows in uni ?).
  No problems on Majka Windows.

- Paul: going up the steps could do with a smoother animation

- Eric stage 6 comment:
  - Display frequency can be changed, but is 60Hz by default, has to be changed by hand and is not hardware's optimal value
  - I just saw one problem: when you switch (alt+tab) to other window, but the game window remains visible on the desktop, then the mouse is hidden when you mouse over the game window (even though the other window has focus).

- werewolf's mouth is too dark

- (2006-05-08 11:42:27) Szymon: hej tu kasia co do poprawek takich prostych i na szybko to mam pytanie o klucz
  (2006-05-08 11:43:15) Szymon: bo szczerze mowiac to go ledwo widac... fajnie by bylo gdyby byl jakos oswietlony...

- bow more interesting:
  - When you hold attack key, arrow/bolt appears on your bow/crossbow
    and you're holding the bow. There is also a crosshair (circle target area)
    that "trembles", because your hands are trembling.

    You shoot when you release Ctrl key. The longer you held Ctrl,
    the more power has the arrow (more velocity), but also the trembling
    of your crosshair (and it's circle) is larger, so your accuracy
    is lower.
  - crosshair for bow
  - showing arrow in shooting anim for bow

- gate
  - need an actual door inside GateExitBox to make the message valid.

- intro moving when the game starts (either movie from the game --- or just some
  nice anim, moving camera around the level.)

Stage 6:
Goal #5 (2.5 Points) - Have a minimum of 2 mini-bosses you must fight in the game.

- maybe load/free creatures animations for specific levels ?
  This would make memory requirements lower, but loading
  time would suffer --- for each level "Loading creatures".

- gate:
  - use S&K red light with maxed intensity to shine on the top of the sword.
  - one tree is inside murek, move it
  - top of columns and "wieza" have wrong UV coords, fix

- better spider_queen model. Inspiration ?
  http://ultimosdiasdegloria.bluehosting.com.br/downloads/arquivos/CitySpiderQueen02.jpg
  http://ultimosdiasdegloria.bluehosting.com.br/downloads/arquivos/CitySpiderQueen01.jpg
  http://ultimosdiasdegloria.bluehosting.com.br/downloads/arquivos/CitySpiderQueen03.jpg

- spider_appears.wav sound do

- spider: try to climb by doing additional MoveAlowed with higher destination
  position. They can't climb on logs now (but maybe it's a good thing ?)

  same for spider_queen --- it can't climb back to MeshTunnel.

- spider queen:
  lay eggs, produce normal spiders.

- alien:
  more aliens on castle_hall ?
  texture the alien finally ?

- test game messages in the middle of the screen ?

- some effects: blood explode when player hits monster.

- different footsteps sound on different ground

cages level:
- windows: don't look like windows
- player can fly through windows --- not good.
- stairs beginning cages and ending castle_hall: endings should be more black, current vertex colouring is not black enough

- when debug menu "give me 20 items" is used, InventoryCurrentItem
  may remain -1. Fix by placing InventoryCurrentItem as inside
  read-only TPlayer property.

- gate:
  - Wall of fence around the level, to get rid of invisible walls.
    Chebmaster:
    a) impassabe cliffs/abysses at the edges of the landscape
       (too high/wide to pass even by flying)
    b) endless sea (level=island)

    Hmm, both are good ideas. I don't want to surround the whole level with sea (I want the level to "feel" like in the middle of the forest). Actually, maybe I'll use all three ideas ---- on the left side of the level I could do a cliff, on the right and bottom I could use wall of fance, and add a little "opening on the sea" on the right side where the river ends.

  - is this a good idea to just force player to restart if he
    jumped into the grave ? I think yes, but later maybe some
    alt way should be possible ?

- cages level:
  - on the other side of the wall, also a door, but blocked by rocks
  - from queen lair, passage to this 2nd hidden room --- some treasures there
  - make real doors that you must click to open them

- "Color depth" and "Display Frequency" are ignored on non-Win32 targets.
  (Seems that judges and most people test on Windows, so no time (it's already 4th May)
  to do this for Unix (xvf86mode) now.

  "Display Frequency" should be definitely possible using xvf86mode,

  "Color depth" --- I'm not sure.
  Looking at xvidtune and gnome-display-properties : no such possibility.
  Possibly color depth is not switchable without restarting XWindows ?

- thunder:
  - 3d sound ?
  - if the light would only shine through the window's shapes it would be even better.

Cages level:
- this natural rock thing better ?
- torch model base : use nice mesh from the base on lantern3.3ds from 3dcafe.com ?

- headlight on cages level ? By torch item ?
  No ? Spot headlight looks poor (must over-triangulate meshes),
  and it doesn't resemble a torch anyway. Positional light with attenuation
  also doesn't look too special.

- Things that I would like to show in new levels:
  - swimming feels great --- show it off more ?
  - lights: Spot light. Moving light.
  - Some moving objects on the level: this is easy to do in my levels. Use it more !
  - more environ sounds: wind blowing.
  - homing missiles make great effect on a vast empty space, like in "Tower" level. Demonstrate this in some "real" level too!

- "Set keys to "Half life 2" scheme" menu command ?

- chooseNewLevel menu: display thumbnails of levels

- when player walks, his weapon should slowly move

- mouse smoothing for mouse look ?
  Seems not needed, at least with my mouse ?
  Players with poor mouses can always just use keys ?

- fix GTK backend to resize screen (surprisingly, it seems that I should
  just use XFV86VidMode from Xlib ? GTK does not wrap this ?)
  and then compile release versions of "The Castle" with GTK backend,
  avoiding override_redirect.

- Mama reports:
  Po uruchomieniu castle.exe mam taki komunikat:
    Error
    castle: Exception EAccessViolation:
    Access violation
  pod windows'98

- creature's footsteps sound ?

- sound when creature sees player for the 1st time

- music volume is affected by sound volume now. That's because listener gain affects everything...

- Add names of guys that did the loops, maybe send them mails ? Some of the loops are plainly great!

- choosing Min/MaxALAllocatedSounds from menu.

- why with wide angle the corner geometry is sometimes clipped ?

- Creatures<->level collision checking should be done using
  creature's bounding box, not CameraRadius.
  Creature's CameraRadius is a hack, and should be preferably removed.
  Same thing for items<->level.

- "Restore defaults" in Sound options.

- Eric stage 4 comment:
  - you can also get "stuck" when colliding against a wall, instead of sliding.

- Enemies:
  - More enemies attacks.
  - Nice 3d effects (lighting-like things, explosions etc.).
  - Models of the two current creatures need to be improved.
    Model of "alien" creature will probably be just removed and replaced
    by something else.
  - Just add more creatures.
    creature hydra (very tall, very long when killed; will be a nice demo of my good collision checking routines)
    creature that attacks by snapping it hand (tentacle ?) far out

- "The Gate" level:
  - intro under menu: camera floating around level with this fog ?

- There must be a way to say that some sectors are not important
  for AI for creatures with Flying. (like ghost)

- sectors and waypoints finish, see README for TO-DOs.

- Improve collisions player<->creatures and player<->items to
  check not only final collisions, but also segment collisions when moving ?
  Otherwise when moving fast (or low FPS count, so FpsCompSpeed large),
  this collision check can fail to work.

  This doesn't seem to be a problem in practice, in practice moving speed is
  not so large (unless running on some ancient GPU with 1 frame per second,
  but there the game is not playable anyway...).

- do weather (I have snow and rain from my szklane_lasy, but they look poor...)

- weapon-less attack (does knockback + small damage)

- non-moving creature (just shooting etc.)

- avoiding falling down sometimes doesn't work like it should.
  I think that I know why: I check where the creature will be after
  2 secs, but what if there is a pit between 2 secs and current pos ?
  Fix by checking everything *along the 2 secs way*.

- ball_missile looks rather funny, too colorful.
  It must look like something fiery, or lighting, or just anything
  that seems at least a little dangerous :)

- various kinds of swinging the sword, with various animations.
  Also they can yield various damage and various hit chances.

- Smooth between various creature states.
  I.e. expand the idea of StandToWalkAnimation, for every combination
  and make it automatic.
  Problem: long load times ("Loading creatures...") and memory consumption.

- creatures can climb high (almost-vertical) walls.
  Actually, player can climb almost-vertical walls too !

  This is not so very noticeable now, because there are no high walls
  now, and creatures' AI doesn't let them fall into deep pits now.

  As a workaround, basic_castle's moat has now edges that are wider down,
  so player and creatures are never able to climb up from the moat...
  But that's still just a workaround.

- I really don't like the "alien" model. It's generally nice,
  but it doesn't fit this game, and I just can't texture it appropriately.
  The basic model was just taken from www.3dcafe.com when I realized that
  I don't have time to make some really nice creature model before
  stage 4 deadline.

  So this creature model is scheduled to be removed and replaced by something
  better after stage 4 deadline.

- put some vertical crates around GlassPrison on basic_castle

- shadows under the creatures:
  - need to be optimized to enabled by default.
    Then set DefaultRenderShadows to true, and remove the warning in
    CastleStartMenu when changing RenderShadows.

  GDC2003_ShadowVolumes.pdf has many interesting ideas.
  Idea to eliminate occluders based on Frustum+LightPos seems suitable for me
  and relatively easy, implement ?

  Implement and use (when you have to) ZFail,
  test like descr in GDC2003_ShadowVolumes.pdf.

  Add creature option CastsShadow (def true) to turn shadows off
  for some creatures. For ball missile turn them off.

  LightCastingShadowsPosition should be cofigurable.
  Can be inited from LightSet.Lights[0].TransfLocation
  (but this doesn't give so much results usually...)

- "shrink" spell (that was *coool* in DUKE 3D !)
  "freeze" (it's from DUKE 3D also)
  "fry"
  "throw back" (throws all enemies slightly backward --- this is also useful
     for player to actually see that monsters get hurt when falling from high)

- change the name --- there already exists game named "castle"!
  And there is "Castle Adventure" !

  "Castle in the rock"
  "High castle"
  "Castle above the mist" ?

- idea from quake: water surface slowly moving (change/move the texture?
  some deformation of the texture ? I'm not sure how to do this trick,
  but it looks very nice!)

- Some buttons visible at lower part of the screen to access some
  things with mouse and to show (as hints) their key shortcuts ?
  ("i" - inventory on/off, "m" - messages).

- mail to author of
  http://www.astrooptik.com/Bildergalerie/latest_namibia/pictures.htm
  : permission to use stars.jpg in my game ?

- apply nice "strips" texture to handle of the sword,
  see http://mediawiki.blender.org/index.php/Manual/PartII/Basic_Mesh_Modelling

- some alpha rect around the item's model ?
  test, although it seems that rotating is enough.

- Not bad creature models from www.3dcafe.com:

  horror/abom
  anatomy_people/creature
  anatomy_people/vampire

  /win/3dmodels/www.katorlegaz.com/animals/horse

- Load / save game ability.

  Place load in the start menu.
  Place save in the game menu.
  In the game menu, when asking before "End Game", do question
  like "Do you want to save the game before ending ?"
  with answers "Save and end the game", "Don't save and end the game", "Cancel".

  When loading game, load saved TimeMessages for this game.

- It would be nice to get Mesa3D working with my game. Right now I get
    castle: indirect_vertex_array.c:1359: __indirect_glTexCoordPointer: Assertion `a != ((void *)0)' failed.
  when loading level, which seems to be a
  <a href="http://forum.linspire.com/viewtopic.php?t=423672&">common
  problem with Mesa</a>

  Update: on kocury, GL_VERSION 1.2 (1.5 Mesa 6.4.1) works OK now.
  Test on ii.uni in 137 room.

----------------------------------------
dist-making to-dos:

- Makefile to pack distro of my game: add at some point svn log:
  svn log -v file:///home/michal/svn/kambi-svn-repos/ \
    castle/trunk kambi_pascal_units/trunk > ChangeLog

- real exe installer for Windows,
  include OpenAL installer
  (run after the question "install Creative's OpenAL implementation ?").

- real packages for Linux, depend (as recommend:) on OpenAL packages

----------------------------------------
Each time before uploading release (to PGD and/or camelot):

- make sure Version (in castlehelp.pas) is good
- test data/ things easy to forget:
  - All textures in VRML files must have relative filenames
      find data/ -type f -iname '*.wrl' | \
        xargs grep filename | \
        grep --invert-match "filename ../" | \
        grep --invert-match "filename //../"
  - All sounds that are intended to be spatialized must be mono:
      wavidentify data/sounds/*.wav | grep stereo
- under Linux and Windows:
  - build debug exe from this dir, test
      make -C /win/mojepasy/units/ clean
      open source/castle.dpr,
      C-F9
      ./castle
  - build release exe from this dir, test
      make -C /win/mojepasy/units/ clean
      open source/castle.dpr,
      C-F10
      ./castle
  - On either Linux or Windows:
    run generate_versions (this must be done before making dists,
    because dists contain HTML files generated from our PHP files,
    and there is recorded version of "The Castle"; so generate_versions
    *must* be run *after new version is compiled* and
    *before make dist is called*)
  - make dist
  - extract created dist
  - test running from extracted created dist
      rm -f ~/.castle.data
      ln -s /tmp/ggg/castle/ ~/.castle.data
      ./castle
      rm -f ~/.castle.data
      ln -s /win/mojepasy/openGL/castle/trunk/ ~/.castle.data
  - Remember to test whether FPC version used was correct
    (to avoid accidentaly compiling with some SVN intermediate version etc.)
  - test building from extracted created dist (using `make build-xxx')
- upload to WWW:
  copy tar.gz to /win/mojewww/camelot/,
  upload to http://stoma.name/michalis
  upload to http://camelot.homedns.org/~michalis/ as usual
    (generate_versions should be already done,
    make md5, upload, html_apply_ontheway),
- make svntag
  check by
    svn list file:///home/michal/svn/kambi-svn-repos/castle/tags/

----------------------------------------